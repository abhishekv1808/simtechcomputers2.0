<header class="sticky top-0 z-50 w-full">

    <div class="bg-gray-900 text-gray-300 text-xs py-2 hidden md:block">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center space-x-6">
                <div class="flex items-center cursor-pointer hover:text-white">
                    <span>English</span>
                    <i class="ri-arrow-down-s-line ml-1"></i>
                </div>
                <div class="flex items-center cursor-pointer hover:text-white">
                    <span>INR</span>
                    <i class="ri-arrow-down-s-line ml-1"></i>
                </div>
                <span class="text-gray-400">Free Shipping On All Orders Over $100</span>
            </div>
            <div class="flex items-center space-x-6">
                <a href="/about-us" class="hover:text-white">About</a>
                <a href="/contact-us" class="hover:text-white">Contact</a>
                <a href="/blogs" class="hover:text-white">Blog</a>
            </div>
        </div>
    </div>

    <!-- Main Header -->
    <div class="bg-gradient-to-r from-[#0071dc] to-[#005bb5] py-4 shadow-lg relative z-20">
        <div class="container mx-auto px-4 flex justify-between items-center max-w-7xl mx-auto">
            
            <!-- Mobile Menu Triggers (Hidden on Desktop) -->
            <div class="md:hidden flex items-center">
                <button id="mobile-menu-btn" class="text-white text-2xl mr-4 hover:bg-white/10 p-2 rounded-full transition-colors"><i class="ri-menu-line"></i></button>
                <a href="/" class="text-white text-xl font-bold flex items-center gap-2">
                <i class="ri-shopping-bag-3-fill"></i>
                <span>Simtech</span>
                </a>
            </div>

            <!-- Logo (Left Desktop) -->
            <div class="hidden md:block mr-12">
                <a href="/" class="text-white text-2xl font-bold flex flex-col items-center leading-none group">
                    <div class="bg-white text-[#0071dc] p-2.5 rounded-xl mb-1 shadow-lg group-hover:scale-110 transition-transform duration-300">
                        <i class="ri-shopping-bag-3-fill text-3xl"></i>
                    </div>
                    <span class="text-sm tracking-widest font-bold text-blue-50">SIMTECH</span>
                </a>
            </div>

            <!-- Search Bar (Center Desktop) -->
            <form action="/search" method="GET" class="hidden md:flex flex-1 max-w-3xl bg-white rounded-full mr-12 mx-auto relative shadow-md border-2 border-transparent focus-within:border-blue-300 transition-all duration-300">
                <div class="relative min-w-[170px] border-r border-gray-100 bg-gray-50/50 h-full rounded-l-full" id="categoryDropdown">
                    <input type="hidden" name="category" id="categoryInput" value="">
                    <button type="button" class="w-full h-full px-5 py-2.5 flex items-center justify-between text-gray-700 text-sm font-medium hover:bg-gray-100/80 transition-colors focus:outline-none rounded-l-full" onclick="toggleDropdown()">
                        <span id="selectedCategory" class="flex items-center gap-2 truncate"><i class="ri-apps-line text-[#0071dc]"></i> All Categories</span>
                        <i class="ri-arrow-down-s-line text-gray-400 transition-transform duration-300" id="dropdownArrow"></i>
                    </button>
                    
                    <!-- Dropdown Menu -->
                    <div id="dropdownMenu" class="absolute top-full left-0 w-[220px] bg-white border border-gray-100 shadow-xl rounded-2xl mt-2 z-50 transition-all duration-300 ease-in-out transform origin-top opacity-0 scale-95 invisible overflow-hidden">
                        <ul class="py-2">
                            <li class="px-5 py-2.5 hover:bg-blue-50 cursor-pointer flex items-center gap-3 text-sm text-gray-700 transition-colors" onclick="selectCategory('', 'All Categories', 'ri-apps-line')">
                                <i class="ri-apps-line text-blue-500 text-lg"></i> All Categories
                            </li>
                            <li class="px-5 py-2.5 hover:bg-blue-50 cursor-pointer flex items-center gap-3 text-sm text-gray-700 transition-colors" onclick="selectCategory('desktop', 'Desktops', 'ri-computer-line')">
                                <i class="ri-computer-line text-blue-500 text-lg"></i> Desktops
                            </li>
                            <li class="px-5 py-2.5 hover:bg-blue-50 cursor-pointer flex items-center gap-3 text-sm text-gray-700 transition-colors" onclick="selectCategory('laptop', 'Laptops', 'ri-macbook-line')">
                                <i class="ri-macbook-line text-indigo-500 text-lg"></i> Laptops
                            </li>
                            <li class="px-5 py-2.5 hover:bg-blue-50 cursor-pointer flex items-center gap-3 text-sm text-gray-700 transition-colors" onclick="selectCategory('monitor', 'Monitors', 'ri-tv-2-line')">
                                <i class="ri-tv-2-line text-purple-500 text-lg"></i> Monitors
                            </li>
                            <li class="px-5 py-2.5 hover:bg-blue-50 cursor-pointer flex items-center gap-3 text-sm text-gray-700 transition-colors" onclick="selectCategory('accessory', 'Accessories', 'ri-headphone-line')">
                                <i class="ri-headphone-line text-teal-500 text-lg"></i> Accessories
                            </li>
                        </ul>
                    </div>
                </div>
                
                <input type="text" name="q" placeholder="Search for products, brands and more..." class="flex-1 px-5 py-2.5 outline-none text-gray-700 placeholder-gray-400 bg-transparent">
                <button type="submit" class="bg-[#0071dc] text-white px-8 rounded-r-full hover:bg-blue-700 transition-all duration-300 flex items-center justify-center group">
                    <i class="ri-search-line text-xl group-hover:scale-110 transition-transform"></i>
                </button>
            </form>

            <!-- Right Actions -->
            <div class="flex items-center space-x-4 text-white">
                <div class="hidden xl:block text-right text-sm mr-4">
                    <div class="text-blue-100 text-xs font-medium mb-0.5">Need Help?</div>
                    <div class="font-bold text-white tracking-wide">+91 98867 86706</div>
                </div>
                
                <div class="flex items-center gap-2">
                    <div class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-white/10 transition-all cursor-pointer group relative" title="Wishlist">
                        <i class="ri-heart-line text-2xl group-hover:text-pink-300 transition-colors"></i>
                    </div>

                    <a href="/cart" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-white/10 transition-all cursor-pointer group relative" title="Cart">
                        <i class="ri-shopping-cart-2-line text-2xl group-hover:text-yellow-300 transition-colors"></i>
                        <% if (cartCount > 0) { %>
                            <span class="absolute -top-1 -right-1 bg-yellow-400 text-blue-900 text-[10px] font-bold rounded-full h-5 w-5 flex items-center justify-center shadow-md border-2 border-[#0071dc]"><%= cartCount %></span>
                        <% } %>
                    </a>

                    <% if (typeof isAuthenticated !== 'undefined' && isAuthenticated) { %>
                         <a href="/profile" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-white/10 transition-all cursor-pointer group relative" title="My Profile">
                            <i class="ri-user-settings-line text-2xl group-hover:text-green-300 transition-colors"></i>
                        </a>
                        <a href="/logout" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-white/10 transition-all cursor-pointer group relative" onclick="event.preventDefault(); showLogoutModal();" title="Logout">
                            <i class="ri-logout-box-r-line text-2xl group-hover:text-red-300 transition-colors"></i>
                        </a>
                        <form id="logout-form" action="/logout" method="POST" style="display: none;"></form>
                    <% } else { %>
                        <a href="/login" class="flex items-center gap-2 bg-white/10 hover:bg-white/20 px-4 py-2 rounded-full transition-all ml-2 backdrop-blur-sm border border-white/10" title="Login">
                            <i class="ri-user-line text-xl"></i>
                            <span class="text-sm font-semibold">Login</span>
                        </a>
                    <% } %>
                </div>
            </div>
        </div>
        
        <!-- Mobile Search (Visible on Mobile) -->
        <div class="md:hidden container mx-auto px-4 mt-4 pb-2">
            <form action="/search" method="GET" class="flex bg-white rounded-full overflow-hidden shadow-md">
                <input type="text" name="q" placeholder="Search..." class="flex-1 px-5 py-2.5 outline-none text-gray-700">
                <button type="submit" class="bg-[#0071dc] text-white px-5">
                    <i class="ri-search-line"></i>
                </button>
            </form>
        </div>
    </div>

    <!-- Mobile Menu Backdrop -->
    <div id="mobile-menu-backdrop" class="fixed inset-0 bg-black/50 z-40 opacity-0 pointer-events-none transition-opacity duration-300"></div>

    <!-- Mobile Navigation Menu (Off-Canvas Drawer) -->
    <div id="mobile-menu" class="fixed top-0 left-0 h-full w-[80%] max-w-[300px] bg-white shadow-2xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out flex flex-col">
        
        <!-- Drawer Header -->
        <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-[#0071dc] text-white">
            <span class="text-lg font-bold flex items-center gap-2">
                <i class="ri-shopping-bag-3-fill"></i> Simtech
            </span>
            <button id="mobile-menu-close" class="text-white hover:text-gray-200 transition-colors">
                <i class="ri-close-line text-2xl"></i>
            </button>
        </div>

        <!-- Drawer Links -->
        <div class="flex-1 overflow-y-auto py-2">
            <ul class="flex flex-col text-gray-700 font-medium text-sm">
                <li><a href="/desktops" class="block px-5 py-3 hover:bg-gray-50 hover:text-[#0071dc] transition-colors border-b border-gray-50 flex items-center gap-3"><i class="ri-computer-line text-lg text-blue-500"></i> Desktops</a></li>
                <li><a href="/laptops" class="block px-5 py-3 hover:bg-gray-50 hover:text-[#0071dc] transition-colors border-b border-gray-50 flex items-center gap-3"><i class="ri-macbook-line text-lg text-indigo-500"></i> Laptops</a></li>
                <li><a href="/monitors" class="block px-5 py-3 hover:bg-gray-50 hover:text-[#0071dc] transition-colors border-b border-gray-50 flex items-center gap-3"><i class="ri-tv-2-line text-lg text-purple-500"></i> Monitors</a></li>
                <li><a href="/accessories" class="block px-5 py-3 hover:bg-gray-50 hover:text-[#0071dc] transition-colors border-b border-gray-50 flex items-center gap-3"><i class="ri-headphone-line text-lg text-teal-500"></i> Accessories</a></li>
            </ul>
        </div>

        <!-- Drawer Footer (Optional) -->
        <div class="p-4 border-t border-gray-100 bg-gray-50">
            <a href="/contact-us" class="block text-center text-sm text-gray-600 hover:text-[#0071dc]">Need Help? Contact Us</a>
        </div>
    </div>

    <!-- Navigation Menu -->
    <div class="bg-white border-b border-gray-100 shadow-sm hidden md:block">
        <div class="container mx-auto px-4 max-w-7xl mx-auto">
            <ul class="flex items-center justify-center space-x-10 py-4 overflow-x-auto text-gray-700 font-medium text-sm scrollbar-hide">
                <li class="whitespace-nowrap"><a href="/desktops" class="hover:text-[#0071dc] transition-colors flex items-center gap-2"><i class="ri-computer-line text-lg text-blue-500"></i> Desktops</a></li>
                <li class="whitespace-nowrap"><a href="/laptops" class="hover:text-[#0071dc] transition-colors flex items-center gap-2"><i class="ri-macbook-line text-lg text-indigo-500"></i> Laptops</a></li>
                <li class="whitespace-nowrap"><a href="/monitors" class="hover:text-[#0071dc] transition-colors flex items-center gap-2"><i class="ri-tv-2-line text-lg text-purple-500"></i> Monitors</a></li>
                <li class="whitespace-nowrap"><a href="/accessories" class="hover:text-[#0071dc] transition-colors flex items-center gap-2"><i class="ri-headphone-line text-lg text-teal-500"></i> Accessories</a></li>
            </ul>
        </div>
    </div>

</header>

<!-- Logout Confirmation Modal -->
<div id="logout-modal" class="fixed inset-0 z-[60] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <!-- Backdrop -->
    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity backdrop-blur-sm" onclick="hideLogoutModal()"></div>

    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="ri-alert-line text-red-600 text-xl"></i>
                        </div>
                        <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                            <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Logout Confirmation</h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500">Are you sure you want to logout? You will need to login again to access your account.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                    <button type="button" class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto" onclick="confirmLogout()">Logout</button>
                    <button type="button" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto" onclick="hideLogoutModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Top Bar -->

<script>
    const publicVapidKey = '<%= vapidPublicKey %>';

    if ('serviceWorker' in navigator) {
        registerServiceWorker().catch(err => console.error(err));
    }

    async function registerServiceWorker() {
        console.log('Registering Service Worker...');
        const register = await navigator.serviceWorker.register('/sw.js', {
            scope: '/'
        });
        console.log('Service Worker Registered...');

        console.log('Registering Push...');
        const subscription = await register.pushManager.subscribe({
            userVisibleOnly: true,
            applicationServerKey: urlBase64ToUint8Array(publicVapidKey)
        });
        console.log('Push Registered...');

        console.log('Sending Push...');
        await fetch('/subscribe', {
            method: 'POST',
            body: JSON.stringify(subscription),
            headers: {
                'content-type': 'application/json'
            }
        });
        console.log('Push Sent...');
    }

    function urlBase64ToUint8Array(base64String) {
        const padding = '='.repeat((4 - base64String.length % 4) % 4);
        const base64 = (base64String + padding)
            .replace(/\-/g, '+')
            .replace(/_/g, '/');

        const rawData = window.atob(base64);
        const outputArray = new Uint8Array(rawData.length);

        for (let i = 0; i < rawData.length; ++i) {
            outputArray[i] = rawData.charCodeAt(i);
        }
        return outputArray;
    }

    // Mobile Menu Toggle
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop');
    const mobileMenuClose = document.getElementById('mobile-menu-close');

    function openMenu() {
        mobileMenu.classList.remove('-translate-x-full');
        mobileMenuBackdrop.classList.remove('opacity-0', 'pointer-events-none');
    }

    function closeMenu() {
        mobileMenu.classList.add('-translate-x-full');
        mobileMenuBackdrop.classList.add('opacity-0', 'pointer-events-none');
    }

    if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', openMenu);
    }

    if (mobileMenuClose) {
        mobileMenuClose.addEventListener('click', closeMenu);
    }

    if (mobileMenuBackdrop) {
        mobileMenuBackdrop.addEventListener('click', closeMenu);
    }

    // Logout Modal Logic
    const logoutModal = document.getElementById('logout-modal');

    function showLogoutModal() {
        if (logoutModal) logoutModal.classList.remove('hidden');
    }

    function hideLogoutModal() {
        if (logoutModal) logoutModal.classList.add('hidden');
    }

    function confirmLogout() {
        const form = document.getElementById('logout-form');
        if (form) form.submit();
    }
</script>
