<header class="sticky top-0 z-50 w-full">

    <div class="bg-gray-900 text-gray-300 text-xs py-2 hidden md:block">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center space-x-6">
                <div class="flex items-center cursor-pointer hover:text-white">
                    <span>English</span>
                    <i class="ri-arrow-down-s-line ml-1"></i>
                </div>
                <div class="flex items-center cursor-pointer hover:text-white">
                    <span>INR</span>
                    <i class="ri-arrow-down-s-line ml-1"></i>
                </div>
                <span class="text-gray-400">Free Shipping On All Orders Over $100</span>
            </div>
            <div class="flex items-center space-x-6">
                <a href="#" class="hover:text-white flex items-center"><i class="ri-flashlight-fill mr-1 text-yellow-400"></i> Flash Sale</a>
                <a href="#" class="hover:text-white">Track Order</a>
                <a href="/about-us" class="hover:text-white">About</a>
                <a href="/contact-us" class="hover:text-white">Contact</a>
                <a href="/blogs" class="hover:text-white">Blog</a>
            </div>
        </div>
    </div>

    <!-- Main Header -->
    <div class="bg-[#0071dc] py-1">
        <div class="container mx-auto px-4 flex justify-between items-center max-w-7xl mx-auto">
            
            <!-- Mobile Menu Triggers (Hidden on Desktop) -->
            <div class="md:hidden flex items-center">
                <button class="text-white text-2xl mr-4"><i class="ri-menu-line"></i></button>
                <a href="/" class="text-white text-xl font-bold flex items-center gap-2">
                <i class="ri-shopping-bag-3-fill"></i>
                <span>Simtech</span>
                </a>
            </div>

            <!-- Logo (Left Desktop) -->
            <div class="hidden md:block mr-8">
                <a href="/" class="text-white text-2xl font-bold flex flex-col items-center leading-none group">
                    <div class="bg-white text-[#0071dc] p-2 rounded-lg mb-1 shadow-lg group-hover:scale-110 transition-transform">
                        <i class="ri-shopping-bag-3-fill text-3xl"></i>
                    </div>
                    <span class="text-sm tracking-wide">SIMTECH</span>
                </a>
            </div>

            <!-- Search Bar (Center Desktop) -->
            <form action="/search" method="GET" class="hidden md:flex flex-1 max-w-2xl bg-white rounded-md mr-8 mx-auto relative">
                <div class="relative min-w-[160px] border-r border-gray-200 bg-gray-50 h-full" id="categoryDropdown">
                    <input type="hidden" name="category" id="categoryInput" value="">
                    <button type="button" class="w-full h-full px-4 py-2 flex items-center justify-between text-gray-600 text-sm hover:bg-gray-100 transition-colors focus:outline-none" onclick="toggleDropdown()">
                        <span id="selectedCategory" class="flex items-center gap-2"><i class="ri-apps-line text-blue-500"></i> All Categories</span>
                        <i class="ri-arrow-down-s-line text-gray-500 transition-transform duration-300" id="dropdownArrow"></i>
                    </button>
                    
                    <!-- Dropdown Menu -->
                    <div id="dropdownMenu" class="absolute top-full left-0 w-[200px] bg-white border border-gray-100 shadow-lg rounded-b-lg z-50 transition-all duration-300 ease-in-out transform origin-top opacity-0 scale-95 invisible">
                        <ul class="py-1">
                            <li class="px-4 py-2 hover:bg-blue-50 cursor-pointer flex items-center gap-3 text-sm text-gray-700 transition-colors" onclick="selectCategory('', 'All Categories', 'ri-apps-line')">
                                <i class="ri-apps-line text-blue-500 text-lg"></i> All Categories
                            </li>
                            <li class="px-4 py-2 hover:bg-blue-50 cursor-pointer flex items-center gap-3 text-sm text-gray-700 transition-colors" onclick="selectCategory('desktop', 'Desktops', 'ri-computer-line')">
                                <i class="ri-computer-line text-blue-500 text-lg"></i> Desktops
                            </li>
                            <li class="px-4 py-2 hover:bg-blue-50 cursor-pointer flex items-center gap-3 text-sm text-gray-700 transition-colors" onclick="selectCategory('laptop', 'Laptops', 'ri-macbook-line')">
                                <i class="ri-macbook-line text-indigo-500 text-lg"></i> Laptops
                            </li>
                            <li class="px-4 py-2 hover:bg-blue-50 cursor-pointer flex items-center gap-3 text-sm text-gray-700 transition-colors" onclick="selectCategory('monitor', 'Monitors', 'ri-tv-2-line')">
                                <i class="ri-tv-2-line text-purple-500 text-lg"></i> Monitors
                            </li>
                            <li class="px-4 py-2 hover:bg-blue-50 cursor-pointer flex items-center gap-3 text-sm text-gray-700 transition-colors" onclick="selectCategory('accessory', 'Accessories', 'ri-headphone-line')">
                                <i class="ri-headphone-line text-teal-500 text-lg"></i> Accessories
                            </li>
                        </ul>
                    </div>
                </div>
                <script>
                    function toggleDropdown() {
                        const menu = document.getElementById('dropdownMenu');
                        const arrow = document.getElementById('dropdownArrow');
                        
                        if (menu.classList.contains('opacity-0')) {
                            // Open
                            menu.classList.remove('opacity-0', 'scale-95', 'invisible');
                            menu.classList.add('opacity-100', 'scale-100', 'visible');
                            arrow.classList.add('rotate-180');
                        } else {
                            // Close
                            menu.classList.add('opacity-0', 'scale-95', 'invisible');
                            menu.classList.remove('opacity-100', 'scale-100', 'visible');
                            arrow.classList.remove('rotate-180');
                        }
                    }

                    function selectCategory(value, text, iconClass) {
                        document.getElementById('categoryInput').value = value;
                        document.getElementById('selectedCategory').innerHTML = `<i class="${iconClass} text-blue-500"></i> ${text}`;
                        toggleDropdown();
                    }

                    // Close dropdown when clicking outside
                    document.addEventListener('click', function(event) {
                        const dropdown = document.getElementById('categoryDropdown');
                        const menu = document.getElementById('dropdownMenu');
                        const arrow = document.getElementById('dropdownArrow');
                        if (!dropdown.contains(event.target)) {
                            if (!menu.classList.contains('opacity-0')) {
                                menu.classList.add('opacity-0', 'scale-95', 'invisible');
                                menu.classList.remove('opacity-100', 'scale-100', 'visible');
                                arrow.classList.remove('rotate-180');
                            }
                        }
                    });
                </script>
                <input type="text" name="q" placeholder="Search For Products..." class="flex-1 px-4 py-2 outline-gray-200 text-gray-700">
                <button type="submit" class="bg-blue-600 text-white px-6 hover:bg-blue-700 transition-colors">
                    <i class="ri-search-line text-xl"></i>
                </button>
            </form>

            <!-- Right Actions -->
            <div class="flex items-center space-x-6 text-white">
                <div class="hidden md:block text-right text-sm">
                    <div class="text-blue-200 text-xs">Contact Us</div>
                    <div class="font-semibold">+91 98867 86706</div>
                </div>
                <div class="text-2xl cursor-pointer hover:text-blue-100 relative">
                    <i class="ri-heart-line"></i>
                </div>
                    <a href="/cart" class="text-2xl cursor-pointer hover:text-blue-100 relative">
                        <i class="ri-shopping-cart-2-line"></i>
                        <% if (cartCount > 0) { %>
                            <span class="absolute -top-2 -right-2 bg-yellow-400 text-blue-900 text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center"><%= cartCount %></span>
                        <% } %>
                    </a>
                <% if (typeof isAuthenticated !== 'undefined' && isAuthenticated) { %>
                     <a href="/profile" class="text-2xl cursor-pointer hover:text-blue-100 relative mr-2" title="My Profile">
                        <i class="ri-user-settings-line"></i>
                    </a>
                    <a href="/logout" class="text-2xl cursor-pointer hover:text-blue-100 relative inline-block" onclick="event.preventDefault(); document.getElementById('logout-form').submit();" title="Logout">
                        <i class="ri-logout-box-r-line"></i>
                    </a>
                    <form id="logout-form" action="/logout" method="POST" style="display: none;"></form>
                <% } else { %>
                    <a href="/login" class="text-2xl cursor-pointer hover:text-blue-100" title="Login">
                        <i class="ri-user-line"></i>
                    </a>
                <% } %>
            </div>
        </div>
        
        <!-- Mobile Search (Visible on Mobile) -->
        <div class="md:hidden container mx-auto px-4 mt-4">
            <form action="/search" method="GET" class="flex bg-white rounded-md overflow-hidden">
                <input type="text" name="q" placeholder="Search..." class="flex-1 px-4 py-2 outline-none text-gray-700">
                <button type="submit" class="bg-blue-700 text-white px-4">
                    <i class="ri-search-line"></i>
                </button>
            </form>
        </div>
    </div>

    <!-- Navigation Menu -->
    <div class="bg-white border-b border-gray-100 shadow-sm hidden md:block">
        <div class="container mx-auto px-4 max-w-7xl mx-auto">
            <ul class="flex items-center justify-center space-x-10 py-4 overflow-x-auto text-gray-700 font-medium text-sm scrollbar-hide">
                <li class="whitespace-nowrap"><a href="/desktops" class="hover:text-[#0071dc] transition-colors flex items-center gap-2"><i class="ri-computer-line text-lg text-blue-500"></i> Desktops</a></li>
                <li class="whitespace-nowrap"><a href="/laptops" class="hover:text-[#0071dc] transition-colors flex items-center gap-2"><i class="ri-macbook-line text-lg text-indigo-500"></i> Laptops</a></li>
                <li class="whitespace-nowrap"><a href="/monitors" class="hover:text-[#0071dc] transition-colors flex items-center gap-2"><i class="ri-tv-2-line text-lg text-purple-500"></i> Monitors</a></li>
                <li class="whitespace-nowrap"><a href="#" class="hover:text-[#0071dc] transition-colors flex items-center gap-2"><i class="ri-apps-line text-lg text-green-500"></i> Software</a></li>
                <li class="whitespace-nowrap"><a href="#" class="hover:text-[#0071dc] transition-colors flex items-center gap-2"><i class="ri-gamepad-line text-lg text-orange-500"></i> Gadgets</a></li>
                <li class="whitespace-nowrap"><a href="#" class="hover:text-[#0071dc] transition-colors flex items-center gap-2"><i class="ri-gamepad-fill text-lg text-red-500"></i> Gaming</a></li>
                <li class="whitespace-nowrap"><a href="/accessories" class="hover:text-[#0071dc] transition-colors flex items-center gap-2"><i class="ri-headphone-line text-lg text-teal-500"></i> Accessories</a></li>
            </ul>
        </div>
    </div>

</header>
<!-- Top Bar -->

<script>
    const publicVapidKey = 'BL2aAaQlcGIfaoihbDnjHr_bFyqlEF3Iy3zWQTymea1UET2Jm4r9tgCgkTBnXdSLBzz4kFOyLWCn1jPhFRzScCM';

    if ('serviceWorker' in navigator) {
        registerServiceWorker().catch(err => console.error(err));
    }

    async function registerServiceWorker() {
        console.log('Registering Service Worker...');
        const register = await navigator.serviceWorker.register('/sw.js', {
            scope: '/'
        });
        console.log('Service Worker Registered...');

        console.log('Registering Push...');
        const subscription = await register.pushManager.subscribe({
            userVisibleOnly: true,
            applicationServerKey: urlBase64ToUint8Array(publicVapidKey)
        });
        console.log('Push Registered...');

        console.log('Sending Push...');
        await fetch('/subscribe', {
            method: 'POST',
            body: JSON.stringify(subscription),
            headers: {
                'content-type': 'application/json'
            }
        });
        console.log('Push Sent...');
    }

    function urlBase64ToUint8Array(base64String) {
        const padding = '='.repeat((4 - base64String.length % 4) % 4);
        const base64 = (base64String + padding)
            .replace(/\-/g, '+')
            .replace(/_/g, '/');

        const rawData = window.atob(base64);
        const outputArray = new Uint8Array(rawData.length);

        for (let i = 0; i < rawData.length; ++i) {
            outputArray[i] = rawData.charCodeAt(i);
        }
        return outputArray;
    }
</script>
