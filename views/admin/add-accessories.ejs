<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('../partials/head') %>
</head>
<body class="bg-[var(--admin-bg)] flex font-sans antialiased text-[var(--admin-text-main)] h-screen overflow-hidden selection:bg-blue-500 selection:text-white transition-colors duration-300">

    <%- include('./includes/navigation') %>

    <main class="flex-grow h-screen overflow-y-auto w-full relative bg-[var(--admin-bg)]">
        <div class="p-6 max-w-[1600px] mx-auto">
            
            <div class="bg-[var(--admin-card)] rounded-xl border border-[var(--admin-border)] shadow-sm">
                <!-- Header inside card -->
                <div class="px-6 py-4 border-b border-[var(--admin-border)] flex items-center justify-between">
                    <h2 class="text-3xl font-bold text-[var(--admin-text-main)]">Add New Accessory</h2>
                    <a href="/admin/products" class="text-[var(--admin-text-muted)] hover:text-[var(--admin-text-main)] text-sm font-medium transition-colors">
                        <i class="ri-close-line text-xl"></i>
                    </a>
                </div>

                <form action="/admin/add-accessories" method="POST" enctype="multipart/form-data" class="p-6" id="addAccessoryForm">
                    
                    <% if (errorMessage) { %>
                        <div class="mb-6 bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg text-sm flex items-center gap-2" role="alert">
                            <i class="ri-error-warning-fill"></i>
                            <span><%= errorMessage %></span>
                        </div>
                    <% } %>

                    <div class="space-y-8">

                        <!-- Section 1: Basic Details -->
                        <div class="bg-[var(--admin-card)] rounded-xl border border-[var(--admin-border)] p-6 shadow-sm">
                            <h3 class="text-lg font-bold text-[var(--admin-text-main)] mb-4 flex items-center gap-2">
                                <i class="ri-article-line text-blue-500"></i> Basic Details
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-xs font-bold text-[var(--admin-text-muted)] uppercase tracking-wider mb-2">Brand</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="ri-store-2-line text-gray-400"></i>
                                        </div>
                                        <select name="brand" class="w-full pl-10 bg-[var(--admin-hover)] border border-[var(--admin-border)] text-[var(--admin-text-main)] rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors appearance-none" required>
                                            <option value="" disabled selected>Select Brand</option>
                                            <option value="Logitech" <%= oldInput.brand === 'Logitech' ? 'selected' : '' %>>Logitech</option>
                                            <option value="Razer" <%= oldInput.brand === 'Razer' ? 'selected' : '' %>>Razer</option>
                                            <option value="Corsair" <%= oldInput.brand === 'Corsair' ? 'selected' : '' %>>Corsair</option>
                                            <option value="HyperX" <%= oldInput.brand === 'HyperX' ? 'selected' : '' %>>HyperX</option>
                                            <option value="SteelSeries" <%= oldInput.brand === 'SteelSeries' ? 'selected' : '' %>>SteelSeries</option>
                                            <option value="Apple" <%= oldInput.brand === 'Apple' ? 'selected' : '' %>>Apple</option>
                                            <option value="Dell" <%= oldInput.brand === 'Dell' ? 'selected' : '' %>>Dell</option>
                                            <option value="HP" <%= oldInput.brand === 'HP' ? 'selected' : '' %>>HP</option>
                                            <option value="Lenovo" <%= oldInput.brand === 'Lenovo' ? 'selected' : '' %>>Lenovo</option>
                                            <option value="Other" <%= oldInput.brand === 'Other' ? 'selected' : '' %>>Other</option>
                                        </select>
                                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                            <i class="ri-arrow-down-s-line text-gray-400"></i>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-[var(--admin-text-muted)] uppercase tracking-wider mb-2">Product Name</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="ri-keyboard-line text-gray-400"></i>
                                        </div>
                                        <input type="text" name="name" value="<%= oldInput.name %>" class="w-full pl-10 bg-[var(--admin-hover)] border border-[var(--admin-border)] text-[var(--admin-text-main)] rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors" placeholder="e.g. MX Master 3S" required>
                                    </div>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-xs font-bold text-[var(--admin-text-muted)] uppercase tracking-wider mb-2">Description</label>
                                    <div class="relative">
                                        <textarea name="description" rows="4" class="w-full bg-[var(--admin-hover)] border border-[var(--admin-border)] text-[var(--admin-text-main)] rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors resize-none" placeholder="Enter detailed product description..."><%= oldInput.description %></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Section 2: Pricing & Inventory -->
                        <div class="bg-[var(--admin-card)] rounded-xl border border-[var(--admin-border)] p-6 shadow-sm">
                            <h3 class="text-lg font-bold text-[var(--admin-text-main)] mb-4 flex items-center gap-2">
                                <i class="ri-price-tag-3-line text-green-500"></i> Pricing & Inventory
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label class="block text-xs font-bold text-[var(--admin-text-muted)] uppercase tracking-wider mb-2">MRP (₹)</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-400 font-bold">₹</span>
                                        </div>
                                        <input type="number" name="mrp" value="<%= oldInput.mrp %>" class="w-full pl-8 bg-[var(--admin-hover)] border border-[var(--admin-border)] text-[var(--admin-text-main)] rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors" placeholder="0.00" required>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-[var(--admin-text-muted)] uppercase tracking-wider mb-2">Selling Price (₹)</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-400 font-bold">₹</span>
                                        </div>
                                        <input type="number" name="price" value="<%= oldInput.price %>" class="w-full pl-8 bg-[var(--admin-hover)] border border-[var(--admin-border)] text-[var(--admin-text-main)] rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors" placeholder="0.00" required>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-[var(--admin-text-muted)] uppercase tracking-wider mb-2">Stock Quantity</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="ri-stack-line text-gray-400"></i>
                                        </div>
                                        <input type="number" name="quantity" value="<%= oldInput.quantity %>" class="w-full pl-10 bg-[var(--admin-hover)] border border-[var(--admin-border)] text-[var(--admin-text-main)] rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors" placeholder="0" required>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden Category -->
                        <input type="hidden" name="category" value="accessory">

                        <!-- Section 3: Media -->
                        <div class="bg-[var(--admin-card)] rounded-xl border border-[var(--admin-border)] p-6 shadow-sm">
                            <h3 class="text-lg font-bold text-[var(--admin-text-main)] mb-4 flex items-center gap-2">
                                <i class="ri-image-line text-orange-500"></i> Product Images
                            </h3>
                            <div id="drop-zone" class="w-full h-[200px] border-2 border-dashed border-[var(--admin-border)] hover:border-blue-500 rounded-xl flex flex-col items-center justify-center bg-[var(--admin-hover)]/30 transition-all cursor-pointer relative overflow-hidden group">
                                <input type="file" name="images" id="file-input" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20" accept="image/*" multiple>
                                <div class="text-center pointer-events-none">
                                    <div class="w-16 h-16 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                                        <i class="ri-upload-cloud-2-line text-3xl text-blue-500"></i>
                                    </div>
                                    <p class="text-[var(--admin-text-main)] font-medium">Click to upload or drag and drop</p>
                                    <p class="text-[var(--admin-text-muted)] text-xs mt-1">SVG, PNG, JPG or GIF (max. 10 images)</p>
                                </div>
                            </div>
                            <div id="preview-area" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mt-4 empty:hidden"></div>
                        </div>

                    </div>

                    <div class="pt-6 mt-6 border-t border-[var(--admin-border)] flex justify-end gap-3">
                        <a href="/admin/products" class="px-5 py-2 rounded-lg border border-[var(--admin-border)] text-[var(--admin-text-muted)] hover:text-[var(--admin-text-main)] hover:bg-[var(--admin-hover)] text-sm font-bold transition-all">Cancel</a>
                        <button type="submit" class="px-6 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold shadow-lg shadow-blue-900/20 transition-all">
                            Save Accessory
                        </button>
                    </div>

                </form>
            </div>

        </div>
    </main>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const previewArea = document.getElementById('preview-area');
        const dataTransfer = new DataTransfer();

        // Drag & Drop visual effects
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.add('border-blue-500', 'bg-blue-50', 'dark:bg-blue-900/10');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.remove('border-blue-500', 'bg-blue-50', 'dark:bg-blue-900/10');
            }, false);
        });

        const updatePreview = () => {
            previewArea.innerHTML = '';
            Array.from(dataTransfer.files).forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const div = document.createElement('div');
                    div.className = 'relative group rounded-lg overflow-hidden border border-[var(--admin-border)] aspect-square';
                    div.innerHTML = `
                        <img src="${e.target.result}" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-white">
                             <span class="text-xs font-medium">${(file.size / 1024).toFixed(1)} KB</span>
                        </div>
                         <button type="button" class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow-sm opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600" onclick="removeFile(${index})">
                            <i class="ri-close-line"></i>
                        </button>
                    `;
                    previewArea.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        };

        window.removeFile = (index) => {
            const newDt = new DataTransfer();
            Array.from(dataTransfer.files).forEach((file, i) => {
                if (i !== index) newDt.items.add(file);
            });
            dataTransfer.items.clear();
            Array.from(newDt.files).forEach(file => dataTransfer.items.add(file));
            
            fileInput.files = dataTransfer.files;
            updatePreview();
        };

        const handleFiles = (files) => {
            if (dataTransfer.items.length + files.length > 10) {
                alert('You can only upload a maximum of 10 images.');
                return;
            }
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    dataTransfer.items.add(file);
                }
            });
            fileInput.files = dataTransfer.files;
            updatePreview();
        };

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        dropZone.addEventListener('drop', (e) => {
            const dt = e.dataTransfer;
            handleFiles(dt.files);
        });
    </script>
</body>
</html>
